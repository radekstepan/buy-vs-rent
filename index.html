<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Buy vs Rent</title>
    <style>
    #svg {
      margin: 0 auto;
      width: 1000px;
    }
    </style>
    <script src="data.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.11.0/d3.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
    <script>
      $(function() {
        const { data, stats, props } = d;

        // const n = 20;
        // const max = Math.max(d3.extent(data.rent)[1], d3.extent(data.buy)[1]);
        //
        // const x = d3.scaleLinear().domain([0, max]).nice(n);
        // const histogram = d3.histogram().domain(x.domain()).thresholds(x.ticks(n));
        // const bins ={
        //   rent: histogram(data.rent),
        //   buy: histogram(data.buy)
        // };

        const keys = [
          { label: 'buy', color: '#28a745' },
          { label: 'rent', color: '#5e64ff' }
        ];

        let height = 800, width = 1000;
        const margin = { 'top': 20, 'right': 20, 'bottom': 20, 'left': 70 };
        width -= margin.left + margin.right;
        height -= margin.top + margin.bottom;

        const svg = d3.select('svg')
        const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

        const x = d3.scaleLinear()
          .rangeRound([0, width]);
        const y = d3.scaleLinear()
          .rangeRound([height, 0]);

        const line = d3.line()
          .x((d, i) => x(i + 1))
          .y(d => y(d));

        x.domain([1, props.years]);
        y.domain([0, stats.max]);

        g.append("g")
          .attr("transform", `translate(0,${height})`)
          .call(d3.axisBottom(x))
          .select(".domain")
          .remove();

        g.append("g")
          .call(d3.axisLeft(y))
          .append("text")
          .attr("fill", "#000")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", "0.71em")
          .attr("text-anchor", "end")
          .text("Net Worth ($)");

        keys.map(k => {
          for (let i = 0; i < props.iterations; i++) {
            // g.selectAll(`${k.label}-circle-${i}`)
            //   .data(d => data[k.label][i])
            //   .enter()
            //   .append("circle")
            //   .attr("fill", k.color)
            //   .attr('fill-opacity', "0.005")
            //   .attr("r", 2)
            //   .attr("cx", (d, i) => x(i + 1))
            //   .attr("cy", d => y(d));

            g.append("path")
              .datum(data[k.label][i])
              .attr("fill", "none")
              .attr("stroke", k.color)
              .attr('stroke-opacity', "0.075")
              .attr("stroke-linejoin", "round")
              .attr("stroke-linecap", "round")
              .attr("stroke-width", 0.5)
              .attr("d", line);
          }
        });
      });
    </script>
  </head>
  <body>
    <div id="svg">
      <svg height="800" width="1000"></svg>
    </div>
  </body>
</html>
